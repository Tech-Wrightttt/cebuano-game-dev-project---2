[gd_scene load_steps=47 format=3 uid="uid://o7gchgjqr1i6"]

[ext_resource type="PackedScene" uid="uid://bklxl232veydp" path="res://assets/player/first_person_arm.tscn" id="1_dadds"]
[ext_resource type="Shader" uid="uid://bt1lbo5yomj25" path="res://game/shaders/retro_camera.gdshader" id="2_w5y0b"]
[ext_resource type="Shader" uid="uid://di14027j7obwb" path="res://game/shaders/VHS.gdshader" id="3_du4nq"]
[ext_resource type="Script" uid="uid://bwvlckt1br7ru" path="res://game/player_interact.gd" id="4_p0vpi"]
[ext_resource type="AudioStream" uid="uid://d8o0j7aod6kg" path="res://soundfx/wood.mp3" id="6_wkljg"]
[ext_resource type="AudioStream" uid="uid://on07xa2628g8" path="res://soundfx/grass.mp3" id="7_iyaem"]
[ext_resource type="AudioStream" uid="uid://cj3hykjw12mvo" path="res://soundfx/outside_bg.ogg" id="8_iyaem"]
[ext_resource type="AudioStream" uid="uid://c4etsp1qrbjun" path="res://soundfx/stone.mp3" id="9_ry671"]
[ext_resource type="Script" uid="uid://ch7do2p0uoidx" path="res://game/floor_type_ray.gd" id="10_4uvqg"]
[ext_resource type="AudioStream" uid="uid://vwjiofxfws3q" path="res://soundfx/rock.mp3" id="10_7fxs2"]
[ext_resource type="AudioStream" uid="uid://d3mp4s4edsost" path="res://soundfx/take_item.mp3" id="11_xkjxy"]
[ext_resource type="AudioStream" uid="uid://dywgkgdh44a6k" path="res://soundfx/use_item.mp3" id="12_2k1gg"]
[ext_resource type="AudioStream" uid="uid://disp65vfwnsfs" path="res://soundfx/panting.mp3" id="14_h2ex5"]
[ext_resource type="PackedScene" uid="uid://b4vqsmmw8umat" path="res://game/player_ui.tscn" id="14_ppdnp"]
[ext_resource type="Texture2D" uid="uid://rwtq0qgxe3e7" path="res://materials/dot (1) (1).png" id="15_7vc3l"]
[ext_resource type="AudioStream" uid="uid://dctsoqptcexoj" path="res://soundfx/clothes.mp3" id="15_cvpk3"]
[ext_resource type="Script" uid="uid://oxllhacwq12h" path="res://game/player_screen_ui.gd" id="15_opbur"]
[ext_resource type="FontFile" uid="uid://puuimmfp3vdq" path="res://assets/Fonts/CRAZK___.TTF" id="16_hobtg"]
[ext_resource type="Script" uid="uid://dlsu1wvnsb5cu" path="res://game/panel.gd" id="17_sghav"]
[ext_resource type="FontFile" uid="uid://dd6gyxnwoo3dv" path="res://assets/Fonts/Rawrote Demo.ttf" id="18_a3s55"]
[ext_resource type="Texture2D" uid="uid://ogjldksd1m4i" path="res://assets/images/icons8-eye-100.png" id="20_opbur"]
[ext_resource type="Texture2D" uid="uid://cg45l7tqeboax" path="res://assets/images/icons8-closed-eye-100.png" id="21_fw65x"]
[ext_resource type="PackedScene" uid="uid://bq0vcrfbroj3a" path="res://dialogues/intro_dialogue.tscn" id="21_opbur"]

[sub_resource type="GDScript" id="GDScript_sh265"]
script/source = "extends CharacterBody3D

# Simplified Godot 4.5 first-person controller with stair snapping
# - plays \"Combat_idle_start\" once, then blends into \"Combat_idle\"
# - basic movement, gravity, mouse look, and head-bob
# - uses \"punch\" input action for punching
# - smooth stair traversal (up and down)

# Movement
var SPEED: float = 4.5
const SPRINT_SPEED: float = 8.0
var sprint_stamina_max: float = 100.0
var sprint_stamina: float = sprint_stamina_max
var sprint_depletion_rate: float = 40.0  # stamina drained per second while sprinting
var sprint_recovery_rate: float = 20.0   # stamina recovered per second when not sprinting
const ACCEL: float = 20.0
const FRICTION: float = 30.0
const AIR_FRICTION: float = 2.0
const JUMP_VELOCITY: float = 5.0

# Look
var MOUSE_SENS: float = 0.0005
const MAX_PITCH: float = deg_to_rad(89.0)

# Head bob
const BOB_FREQ: float = 2.0
const BOB_AMP: float = 0.08
const BOB_LERP: float = 2.0

# Stairs
const MAX_STEP_HEIGHT: float = 0.5
@onready var overlay = get_node(\"../PostProcessEffect2\")
var overlay_visible := false
@onready var progress_bar = $CanvasLayer2/SanityBar
@onready var sprint_bar = $CanvasLayer2/SprintBar
@onready var sprint_bar_label = $CanvasLayer2/SprintBar/SprintBarLabel
@onready var progress_bar_label = $CanvasLayer2/SanityBar/SanityBarLabel
@onready var open_eyes = $\"PlayerScreenUI/Open eyes\"
@onready var close_eyes = $\"PlayerScreenUI/Close eyes\"

# UI elements to hide during dialogue
@onready var player_screen_ui = $PlayerScreenUI
@onready var canvas_layer_2 = $CanvasLayer2

var third_eye_active := false
var third_eye_depletion_rate := 20.0  # How much per second to drain
var third_eye_refill_rate := 10.0     # How much per second to refill

@onready var crosshair = $PlayerScreenUI/crosshair
const COLOR_DEFAULT = Color(1,1,1)  # white
const COLOR_INTERACTABLE = Color(1,1,0)  # yellow

var is_sprinting: bool = false
@onready var head: Node3D = $Head
@onready var camera: Camera3D = $Head/Camera3D
@onready var anim: AnimationPlayer = $PSX_First_Person_Arms/AnimationPlayer

# Raycasts for stair detection
@onready var stairs_below_raycast: RayCast3D = $StairsBelowRayCast3D
@onready var stairs_ahead_raycast: RayCast3D = $StairsAheadRayCast3D
@onready var head_bob: AnimationPlayer = $HeadBob
@onready var flashlight: SpotLight3D = $Head/Camera3D/Spotlight/Flashlight

@onready var rock_step: AudioStreamPlayer3D = $Sounds/Rock_Step
@onready var stone_step: AudioStreamPlayer3D = $Sounds/Stone_Step
@onready var grass_step: AudioStreamPlayer3D = $Sounds/Grass_Step
@onready var wood_step: AudioStreamPlayer3D = $Sounds/Wood_Step
@onready var floor_type_ray: RayCast3D = $FootStepAudio
@onready var outside_bg: AudioStreamPlayer3D = $Sounds/Outside_BG
var current_surface: String = \"\"
var outside_bg_playing: bool = false

var is_walking: bool = false
var bob_time: float = 0.0
var cam_rest_y: float = 0.0
var idle_ready: bool = false
var is_attacking: bool = false
var dialogue_active: bool = false

# Stair tracking
var _snapped_to_stairs_last_frame: bool = false
var _last_frame_was_on_floor: int = -999999

# for respawn and stuff after jumpscare
const SANITY_DEATH_THRESHOLD: float = 40.0  # If sanity below this, game over
const SANITY_PENALTY_ON_DEATH: float = 30.0  # How much sanity to lose when caught
var can_be_killed: bool = true  # Prevent multiple deaths at once
var respawn_position: Vector3 = Vector3.ZERO  # Where to respawn player
@onready var respawn_point = $\"../House/doors/respawn_destination\"
var fade_overlay: ColorRect = null  # Persistent reference to fade overlay

# mini scenes
@onready var fail_message_label = $CanvasLayer2/FailLabel
@onready var haunted_message_label = $CanvasLayer2/HauntedLabel
@onready var night_counter_gameplay =$CanvasLayer2/Night_Counter_GamePlay
@onready var ghost = get_node(\"../House/doors/ghost\")
var firstdialoguescene: bool = true
var seconddialoguescene: bool = true

@onready var wood_walk: AudioStreamPlayer3D = $Sounds/Wood_Step
var can_play_footstep = true

func _ready() -> void:
	if sprint_bar:
		sprint_bar.show_percentage = false

	if progress_bar:
		progress_bar.show_percentage = false

	crosshair.visible = true
	crosshair.modulate = Color(1.0, 1.0, 1.0, 1.0)  # full opaque white
	Input.set_mouse_mode(Input.MOUSE_MODE_CAPTURED)
	rotation.y = deg_to_rad(90)
	# Setup raycasts if they don't exist
	_setup_stair_raycasts()
	
	# Wait a frame so camera exists and transforms are valid
	await get_tree().process_frame
	
	if camera:
		cam_rest_y = camera.position.y
	
	# Play startup idle, then connect to animation_finished
	if anim:
		if not anim.animation_finished.is_connected(_on_animation_finished):
			anim.animation_finished.connect(_on_animation_finished)
		anim.play(\"Combat_idle_start\")
	
	if overlay:
		overlay.visible = false
		overlay_visible = false
		open_eyes.visible=false
		close_eyes.visible=true
		
	if sprint_bar:
		sprint_bar.min_value = 0
		sprint_bar.max_value = sprint_stamina_max
		sprint_bar.value = sprint_stamina_max
	
	# Start the intro dialogue
	_start_intro_dialogue()
	
	# Store initial spawn position
	respawn_position = respawn_point.global_position

func _start_intro_dialogue() -> void:
	# Get the intro_dialogue child node
	var intro_dialogue = get_node_or_null(\"intro_dialogue\")
	if intro_dialogue:
		# Hide ALL UI elements when dialogue starts
		_hide_all_ui()
		dialogue_active = true
		
		# Disable player movement by setting process and physics process to false
		set_physics_process(false)
		set_process(false)
		
		# Make sure the dialogue canvas is visible
		intro_dialogue.visible = true
		
		# The dialogue will automatically play its animation in its _ready() function
		print(\"Intro dialogue started\")
		
		# Wait for 7 seconds then end the dialogue
		await get_tree().create_timer(7.0).timeout
		_end_intro_dialogue()
	else:
		print(\"Intro dialogue node not found\")

func _end_intro_dialogue() -> void:
	# Get the intro_dialogue child node
	var intro_dialogue = get_node_or_null(\"intro_dialogue\")
	if intro_dialogue:
		# Stop the animation if it's playing
		var animation_player = intro_dialogue.get_node_or_null(\"AnimationPlayer\")
		if animation_player:
			animation_player.stop()
		
		# Optional: Remove it completely from the scene
		intro_dialogue.queue_free()
	
	# Show all UI elements again and mark dialogue as inactive
	_show_all_ui()
	dialogue_active = false
	
	# Re-enable player movement
	set_physics_process(true)
	set_process(true)
	
	print(\"Intro dialogue finished\")

func _hide_all_ui() -> void:
	# Hide crosshair and all UI elements
	if crosshair:
		crosshair.visible = false
	
	# Hide PlayerScreenUI (crosshair, open/close eyes, etc.)
	if player_screen_ui:
		player_screen_ui.visible = false
	
	# Hide CanvasLayer2 (sanity bar, sprint bar, etc.)
	if canvas_layer_2:
		canvas_layer_2.visible = false
	
	# Hide any other UI elements you might have
	# Add more UI hiding here if needed

func _show_all_ui() -> void:
	# Show crosshair and all UI elements
	if crosshair:
		crosshair.visible = true
	
	# Show PlayerScreenUI
	if player_screen_ui:
		player_screen_ui.visible = true
	
	# Show CanvasLayer2
	if canvas_layer_2:
		canvas_layer_2.visible = true
	
	# Show any other UI elements you might have
	# Add more UI showing here if needed

func _setup_stair_raycasts() -> void:
	# Create raycasts if they don't exist
	if not stairs_below_raycast:
		stairs_below_raycast = RayCast3D.new()
		stairs_below_raycast.name = \"StairsBelowRayCast3D\"
		stairs_below_raycast.target_position = Vector3(0, -MAX_STEP_HEIGHT, 0)
		stairs_below_raycast.enabled = true
		stairs_below_raycast.collide_with_areas = false
		add_child(stairs_below_raycast)
	
	if not stairs_ahead_raycast:
		stairs_ahead_raycast = RayCast3D.new()
		stairs_ahead_raycast.name = \"StairsAheadRayCast3D\"
		stairs_ahead_raycast.target_position = Vector3(0, -MAX_STEP_HEIGHT, 0)
		stairs_ahead_raycast.enabled = true
		stairs_ahead_raycast.collide_with_areas = false
		add_child(stairs_ahead_raycast)
		
func _process(delta: float) -> void:
	if dialogue_active:
		return
		
	if third_eye_active:
		if progress_bar.value > progress_bar.min_value:
			progress_bar.value = max(progress_bar.value - third_eye_depletion_rate * delta, progress_bar.min_value)
	else:
		if progress_bar.value < progress_bar.max_value:
			progress_bar.value = min(progress_bar.value + third_eye_refill_rate * delta, progress_bar.max_value)
	# Sprint stamina update
	if is_sprinting and sprint_stamina > 0:
		sprint_stamina = max(sprint_stamina - sprint_depletion_rate * delta, 0)
	elif sprint_stamina < sprint_stamina_max:
		sprint_stamina = min(sprint_stamina + sprint_recovery_rate * delta, sprint_stamina_max)
	
	if sprint_bar and sprint_bar_label:
		sprint_bar.value = sprint_stamina
		sprint_bar_label.text = str(int(sprint_stamina)) + \" / \" + str(int(sprint_stamina_max))

	if progress_bar and progress_bar_label:
		progress_bar_label.text = str(int(progress_bar.value)) + \" / \" + str(int(progress_bar.max_value))
		
	if Global.completed_dialogues.has(\"dialogue_trigger1\") and Global.completed_dialogues[\"dialogue_trigger1\"]:
		if firstdialoguescene:
			firstdialoguescene = false
			each_night_respawn()
			
	if Global.completed_dialogues.has(\"dialogue_trigger2\") and Global.completed_dialogues[\"dialogue_trigger2\"]:
		if seconddialoguescene:
			seconddialoguescene = false
			#each_night_respawn()
	


		
func each_night_respawn() -> void:
	# Show the night counter and tasks UI (night_counter_gameplay)
	if night_counter_gameplay:
		print(\"Current night is: \", Global.current_night)
		night_counter_gameplay.visible = true
		night_counter_gameplay.modulate.a = 0.0  # Start transparent
		night_counter_gameplay.z_index = 100  # Make sure it's above other UI

		# Display current night from global singleton

		if night_counter_gameplay:
			night_counter_gameplay.text = \"Night %d\" % Global.current_night

		# Fade UI in quickly
		var tween = create_tween()
		tween.tween_property(night_counter_gameplay, \"modulate:a\", 1.0, 1.25)
		await tween.finished

	# Fade out the screen, like in respawn_player()
	await fade_screen_to_black(0.5)

	# Reset player position and state as in respawn_player
	# Reset player state
	global_position = respawn_position
	velocity = Vector3.ZERO
	rotation.y = deg_to_rad(90)
	if head:
		head.rotation.x = 0
	
	# CRITICAL: Make sure player camera is active
	if camera:
		camera.current = true
		print(\"üì∑ Player camera set to current\")

	# Wait before fading back in
	await get_tree().create_timer(3.0).timeout

	# Fade UI out
	if night_counter_gameplay:
		var tween = create_tween()
		tween.tween_property(night_counter_gameplay, \"modulate:a\", 0.0, 1.25)
		await tween.finished
		night_counter_gameplay.visible = false

	# Fade screen back from black
	fade_screen_from_black(0.5)
	#gitang tang nko kadali ang aawait
	
	set_physics_process(true)
	set_process(true)
	dialogue_active = false
	Input.set_mouse_mode(Input.MOUSE_MODE_CAPTURED)
	
	if Global.current_night == 1:
		#await play_open_eyes_cutscene()
		await play_cutscene(\"res://game/cutscenes/telephone_dialogue.tscn\", 30.5)
		print(\"played open eyes cut\")
		#await get_tree().create_timer(30.0).timeout
		ghost.is_ghost_started = true
		#i want it so that it plays a scene or calls scene that plays its cutscene
		#but i do not want this affecting the game it has to be separate 
		#it then plays goes away and then the game continues
		
	
func play_open_eyes_cutscene() -> void:
	var cutscene = preload(\"res://game/cutscenes/game_intro.tscn\").instantiate()
	get_tree().root.add_child(cutscene)

	# Optionally: disable controls during cutscene
	set_process(false)
	set_physics_process(false)

	# Wait for the cutscene to finish (use a signal if needed)
	await get_tree().create_timer(5.5).timeout  # Adjust time to match animation/cutscene duration

	# Remove cutscene and restore controls
	cutscene.queue_free()
	set_process(true)
	set_physics_process(true)

	

func _on_animation_finished(anim_name: String) -> void:
	if anim_name == \"Combat_idle_start\":
		if anim:
			anim.play(\"Combat_idle\")
		idle_ready = true
	elif anim_name == \"Combat_punch_left\":
		is_attacking = false
		if anim:
			anim.play(\"Combat_idle\")

func _input(event: InputEvent) -> void:
	if dialogue_active:
		return
		
	# Mouse look
	if event is InputEventMouseMotion:
		rotate_y(-event.relative.x * MOUSE_SENS)
		
		if head:
			var new_pitch: float = head.rotation.x - event.relative.y * MOUSE_SENS
			head.rotation.x = clamp(new_pitch, -MAX_PITCH, MAX_PITCH)
	if Input.is_action_just_pressed(\"proceed_to_next_night\"):
		Global.progress_to_next_night()
		print(\"Advanced to night: \", Global.current_night)
		
	if event.is_action_pressed(\"punch\"):
		_try_punch()
	
	if event.is_action_pressed(\"move_third_eye\"):
		print(\"test!\")
		overlay_visible = !overlay_visible
		if overlay: 
			overlay.visible = overlay_visible
			third_eye_active = overlay_visible
			open_eyes.visible = overlay_visible
			close_eyes.visible=!overlay_visible
			

		
func _try_punch() -> void:
	if dialogue_active:
		return
		
	if not is_attacking and idle_ready and anim:
		is_attacking = true
		anim.play(\"Combat_punch_left\")

func _physics_process(delta: float) -> void:
	if dialogue_active:
		return
	
	if is_on_floor():
		_last_frame_was_on_floor = Engine.get_physics_frames()
		if Input.is_action_pressed(\"sprint\") and sprint_stamina > 0:
			is_sprinting = true
		else:
			is_sprinting = false
	
	if not is_on_floor():
		velocity += get_gravity() * delta
		
	var current_speed = SPRINT_SPEED if is_sprinting else SPEED
	
	var input_dir: Vector2 = Input.get_vector(\"move_left\", \"move_right\", \"move_forward\", \"move_backward\")
	
	var direction: Vector3 = Vector3.ZERO
	if input_dir.length() > 0.0:
		var local_direction: Vector3 = Vector3(input_dir.x, 0.0, input_dir.y)
		direction = (transform.basis * local_direction).normalized()
	
	var current_friction: float = FRICTION if is_on_floor() else AIR_FRICTION
	
	if direction.length() > 0.0:
		velocity.x = move_toward(velocity.x, direction.x * current_speed, ACCEL * delta)
		velocity.z = move_toward(velocity.z, direction.z * current_speed, ACCEL * delta)
	else:
		velocity.x = move_toward(velocity.x, 0.0, current_friction * delta)
		velocity.z = move_toward(velocity.z, 0.0, current_friction * delta)
	
	if not _snap_up_stairs_check(delta, direction):
		move_and_slide()
		_snap_down_to_stairs_check()
	
	if not is_attacking:
		_apply_head_bob(delta, direction)
	
	_update_crosshair_color()

func _update_crosshair_color() -> void:
	if not camera or not crosshair:
		return

	var from = camera.global_transform.origin
	var to = camera.global_transform.origin + (camera.global_transform.basis.z * -1000) # Long ray forward

	var space_state = get_world_3d().direct_space_state

	var query = PhysicsRayQueryParameters3D.new()
	query.from = from
	query.to = to
	query.exclude = [self]

	var result = space_state.intersect_ray(query)

	if result:
		var collider = result.collider
		if collider and collider.is_in_group(\"interactable\"):
			crosshair.modulate = COLOR_INTERACTABLE
			return

	crosshair.modulate = COLOR_DEFAULT

func _snap_down_to_stairs_check() -> void:
	if not stairs_below_raycast:
		return
	
	var did_snap: bool = false
	stairs_below_raycast.force_raycast_update()
	
	var floor_below: bool = stairs_below_raycast.is_colliding() and not _is_surface_too_steep(stairs_below_raycast.get_collision_normal())
	var was_on_floor_last_frame: bool = Engine.get_physics_frames() == _last_frame_was_on_floor
	
	if not is_on_floor() and velocity.y <= 0 and (was_on_floor_last_frame or _snapped_to_stairs_last_frame) and floor_below:
		var params := PhysicsTestMotionParameters3D.new()
		params.from = global_transform
		params.motion = Vector3(0, -MAX_STEP_HEIGHT, 0)
		
		var result := PhysicsTestMotionResult3D.new()
		if PhysicsServer3D.body_test_motion(get_rid(), params, result):
			var translate_y: float = result.get_travel().y
			position.y += translate_y
			apply_floor_snap()
			did_snap = true
	
	_snapped_to_stairs_last_frame = did_snap

func _snap_up_stairs_check(delta: float, direction: Vector3) -> bool:
	if not stairs_ahead_raycast:
		return false
	
	if not is_on_floor() and not _snapped_to_stairs_last_frame:
		return false
	
	if direction.length() == 0.0:
		return false
	
	var expected_move_motion: Vector3 = velocity * Vector3(1, 0, 1) * delta
	var step_pos_with_clearance: Transform3D = global_transform.translated(expected_move_motion + Vector3(0, MAX_STEP_HEIGHT * 2, 0))
	
	var params := PhysicsTestMotionParameters3D.new()
	params.from = step_pos_with_clearance
	params.motion = Vector3(0, -MAX_STEP_HEIGHT * 2, 0)
	
	var result := PhysicsTestMotionResult3D.new()
	if PhysicsServer3D.body_test_motion(get_rid(), params, result):
		var collider: Object = result.get_collider()
		if collider and (collider is StaticBody3D or collider is CSGShape3D):
			var step_height: float = ((step_pos_with_clearance.origin + result.get_travel()) - global_position).y
			
			if step_height > MAX_STEP_HEIGHT or step_height <= 0.01:
				return false
			if (result.get_collision_point(0) - global_position).y > MAX_STEP_HEIGHT:
				return false
			
			stairs_ahead_raycast.global_position = result.get_collision_point(0) + Vector3(0, MAX_STEP_HEIGHT, 0) + expected_move_motion.normalized() * 0.1
			stairs_ahead_raycast.force_raycast_update()
			
			if stairs_ahead_raycast.is_colliding() and not _is_surface_too_steep(stairs_ahead_raycast.get_collision_normal()):
				global_position = step_pos_with_clearance.origin + result.get_travel()
				apply_floor_snap()
				_snapped_to_stairs_last_frame = true
				return true
	
	return false

func _is_surface_too_steep(normal: Vector3) -> bool:
	return normal.angle_to(Vector3.UP) > floor_max_angle

func _apply_head_bob(delta: float, dir: Vector3) -> void:
	if not camera:
		return
	
	if cam_rest_y == 0.0:
		cam_rest_y = camera.position.y
	
	if is_on_floor() and dir.length() > 0.0:
		bob_time += delta * BOB_FREQ
		
		var target_y: float = cam_rest_y + sin(bob_time * TAU) * BOB_AMP
		camera.position.y = lerp(camera.position.y, target_y, BOB_LERP * delta)
	
		if not is_walking:
			is_walking = true
			head_bob.stop()
			head_bob.play(\"headbob\")
			
	else:
		bob_time = 0.0
		camera.position.y = lerp(camera.position.y, cam_rest_y, BOB_LERP * delta)
		if is_walking:
			is_walking = false
			head_bob.pause()

func third_eye():
	pass

func _unhandled_input(event: InputEvent) -> void:
	if dialogue_active:
		return
		
	if event.is_action_pressed(\"ui_cancel\"):
		if Input.get_mouse_mode() == Input.MOUSE_MODE_CAPTURED:
			Input.set_mouse_mode(Input.MOUSE_MODE_VISIBLE)
		else:
			Input.set_mouse_mode(Input.MOUSE_MODE_CAPTURED)
			
func take_sanity_damage() -> void:
	if not can_be_killed:
		return
	
	can_be_killed = false
	var current_sanity = progress_bar.value
	
	print(\"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\")
	print(\"üëª Ghost caught player!\")
	print(\"üí≠ Current sanity: %.1f\" % current_sanity)
	
	# Check if sanity is too low for another death
	if progress_bar.max_value <= SANITY_DEATH_THRESHOLD:
		print(\"üíÄ Sanity too low - GAME OVER!\")
		print(\"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\")
		trigger_game_over()
	else:
		# Deduct sanity and respawn
		var new_sanity = max(current_sanity - SANITY_PENALTY_ON_DEATH, 0)
		progress_bar.value = new_sanity
		progress_bar.max_value -= SANITY_PENALTY_ON_DEATH
		print(\"‚ö†Ô∏è Lost %.1f sanity! New sanity: %.1f\" % [SANITY_PENALTY_ON_DEATH, new_sanity])
		print(\"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\")
		respawn_player()
		
func trigger_game_over() -> void:
	# Disable player controls
	set_physics_process(false)
	set_process(false)
	Input.set_mouse_mode(Input.MOUSE_MODE_VISIBLE)
	
	# Fade to black
	await fade_screen_to_black(2.0)
	
	ghost.disable_permanently()
	$Sounds/Packing.play()
	
	# Show the death message
	if fail_message_label:
		fail_message_label.text = \"Ayoko na dito, kailangan ko nang umalis\"
		fail_message_label.visible = true
		fail_message_label.modulate.a = 0.0
		fail_message_label.z_index = 200
		# Fade the text in smoothly
		var tween = create_tween()
		tween.tween_property(fail_message_label, \"modulate:a\", 1.0, 2.0)
		await tween.finished
	
	# Wait before changing the scene
	await get_tree().create_timer(3.0).timeout
	
	# Change to game over scene
	if has_node(\"/root/SceneManager\"):
		get_node(\"/root/SceneManager\").change_scene_threaded(\"res://scenes/game_over.tscn\")
	else:
		get_tree().change_scene_to_file(\"res://scenes/game_over.tscn\")

func respawn_player() -> void:
	print(\"üîÑ Respawning player...\")
	
	# Fade to black
	var fade_duration = 0.5
	await fade_screen_to_black(fade_duration)
	$Sounds/Panting.play()
	if haunted_message_label:
		haunted_message_label.text = \"Guniguni ko lang yata yun\"
		haunted_message_label.visible = true
		haunted_message_label.modulate.a = 0.0
		haunted_message_label.z_index = 200
		# Fade the text in smoothly
		var tween = create_tween()
		tween.tween_property(haunted_message_label, \"modulate:a\", 1.0, 2.0)
		await tween.finished
	
	# Reset player state
	global_position = respawn_position
	velocity = Vector3.ZERO
	rotation.y = deg_to_rad(90)
	if head:
		head.rotation.x = 0
	
	# CRITICAL: Make sure player camera is active
	if camera:
		camera.current = true
		print(\"üì∑ Player camera set to current\")
		
	# Wait a moment
	await get_tree().create_timer(3.0).timeout
	
	# Fade back in
	await fade_screen_from_black(fade_duration)
	
	# Re-enable death
	can_be_killed = true
	haunted_message_label.visible = false
	print(\"‚úÖ Player respawned at: \", respawn_position)

func fade_screen_to_black(duration: float) -> void:
	# Create fade overlay if it doesn't exist
	if not fade_overlay:
		fade_overlay = ColorRect.new()
		fade_overlay.name = \"FadeOverlay\"
		fade_overlay.color = Color.BLACK
		fade_overlay.modulate.a = 0.0
		fade_overlay.set_anchors_and_offsets_preset(Control.PRESET_FULL_RECT)
		fade_overlay.z_index = 100  # Make sure it's on top of everything
		
		var canvas_layer = get_node_or_null(\"CanvasLayer2\")
		if canvas_layer:
			canvas_layer.add_child(fade_overlay)
			print(\"‚úÖ Created fade overlay\")
	
	if fade_overlay:
		fade_overlay.visible = true
		fade_overlay.modulate.a = 0.0
		var tween = create_tween()
		tween.tween_property(fade_overlay, \"modulate:a\", 1.0, duration)
		await tween.finished
		print(\"‚ö´ Screen faded to black\")

func fade_screen_from_black(duration: float) -> void:
	if fade_overlay:
		var tween = create_tween()
		tween.tween_property(fade_overlay, \"modulate:a\", 0.0, duration)
		await tween.finished
		fade_overlay.visible = false
		print(\"‚ö™ Screen faded back in\")

# Optional: Set a new respawn point (e.g., when reaching a checkpoint)
func set_respawn_point(new_position: Vector3) -> void:
	respawn_position = new_position
	print(\"üìç New respawn point set: \", new_position)
	
func play_cutscene(cutscene_path: String, duration: float = 5.5) -> void:
	if not ResourceLoader.exists(cutscene_path):
		push_error(\"Cutscene not found at: \" + cutscene_path)
		return
	
	var cutscene = load(cutscene_path).instantiate()
	get_tree().root.add_child(cutscene)
	
	# Disable player controls
	set_process(false)
	set_physics_process(false)
	Input.set_mouse_mode(Input.MOUSE_MODE_VISIBLE)
	
	# CRITICAL: Make the cutscene camera active
	var cutscene_camera = cutscene.get_node_or_null(\"Camera3D\")
	if cutscene_camera and cutscene_camera is Camera3D:
		cutscene_camera.current = true
		print(\"üì∑ Cutscene camera activated\")
	else:
		push_warning(\"No Camera3D found in cutscene!\")
	
	# Hide player UI during cutscene
	_hide_all_ui()
	
	# Wait for cutscene duration or signal
	if cutscene.has_signal(\"cutscene_finished\"):
		await cutscene.cutscene_finished
	else:
		await get_tree().create_timer(duration).timeout
	
	# CRITICAL: Restore player camera
	if camera:
		camera.current = true
		print(\"üì∑ Player camera restored\")
	
	# Cleanup
	cutscene.queue_free()
	
	# Show player UI again
	_show_all_ui()
	
	set_process(true)
	set_physics_process(true)
	Input.set_mouse_mode(Input.MOUSE_MODE_CAPTURED)
"

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_opbur"]
albedo_color = Color(0.19607843, 1, 1, 1)
stencil_mode = 3
stencil_flags = 2
stencil_reference = 2

[sub_resource type="CapsuleMesh" id="CapsuleMesh_sh265"]
material = SubResource("StandardMaterial3D_opbur")
radius = 0.3
height = 3.25

[sub_resource type="ConvexPolygonShape3D" id="ConvexPolygonShape3D_iyaem"]
points = PackedVector3Array(0.34477568, 1.3923018, 0.08683916, -0.325728, -1.4440001, -0.11937879, -0.325728, -1.4440001, 0.13842647, -0.325728, 1.4440001, 0.13842647, -0.11937879, 1.4440001, -0.325728, 0.2931884, -1.3923018, -0.2225534, 0.08683916, -1.3923018, 0.34477568, -0.067791484, 1.3923018, 0.34477568, 0.24160108, 1.3923018, -0.27414072, -0.11937879, -1.4440001, -0.325728, 0.2931884, -1.4440001, 0.19001377, 0.24160108, 1.4956986, 0.24160108, -0.325728, 1.3409265, -0.17096609, -0.2225534, -1.3923018, 0.2931884, 0.13842647, -1.4440001, -0.325728, 0.08352814, -1.5797893, 0.13290623, 0.34477568, -1.3923018, -0.067791484, 0.34477568, 1.3923018, -0.067791484, -0.11366492, 1.57731, -0.11366492, -0.2225534, 1.3923018, 0.2931884, -0.17096609, -1.3409265, -0.325728, 0.13842647, 1.4440001, -0.325728, 0.08683916, 1.3923018, 0.34477568, -0.11366492, -1.57731, -0.11366492, 0.083528265, 1.5797919, 0.13290644, 0.19001377, -1.4440001, 0.2931884, 0.2931884, 1.4956986, -0.17096609, -0.067791484, -1.3923018, 0.34477568, 0.2931884, -1.4956986, -0.17096609, 0.34477568, -1.3923018, 0.08683916, -0.17096609, 1.3409265, -0.325728, -0.325728, -1.3409265, -0.17096609)

[sub_resource type="Animation" id="Animation_4fto2"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Head/Camera3D:position")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector3(0, -0.1, -0.2)]
}

[sub_resource type="Animation" id="Animation_d631c"]
resource_name = "headbob"
loop_mode = 1
step = 0.0
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Head/Camera3D:position")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.23333333, 0.5, 0.75),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 0,
"values": [Vector3(0, -0.1, -0.2), Vector3(0.05, -0.05, -0.2), Vector3(0, -0.1, -0.2), Vector3(-0.05, -0.05, -0.2)]
}
tracks/1/type = "method"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("FootStepAudio")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0.25, 0.76),
"transitions": PackedFloat32Array(1, 1),
"values": [{
"args": [],
"method": &"play_step_sounds"
}, {
"args": [],
"method": &"play_step_sounds"
}]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_wkljg"]
_data = {
&"RESET": SubResource("Animation_4fto2"),
&"headbob": SubResource("Animation_d631c")
}

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_ppdnp"]
bg_color = Color(0.66, 0, 0.010999832, 0.49019608)
border_width_left = 5
border_width_top = 5
border_width_right = 5
border_width_bottom = 5
border_color = Color(1, 1, 1, 1)
border_blend = true
corner_radius_top_left = 15
corner_radius_top_right = 15
corner_radius_bottom_right = 15
corner_radius_bottom_left = 15
expand_margin_left = 10.0
expand_margin_top = 10.0
expand_margin_right = 10.0
expand_margin_bottom = 10.0

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_7vc3l"]
bg_color = Color(1, 1, 1, 1)
corner_radius_top_left = 10
corner_radius_top_right = 10
corner_radius_bottom_right = 10
corner_radius_bottom_left = 10

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_fw65x"]
bg_color = Color(0.22862497, 0.022499979, 0.75, 0.5803922)
border_width_left = 5
border_width_top = 5
border_width_right = 5
border_width_bottom = 5
border_color = Color(1, 1, 1, 1)
border_blend = true
corner_radius_top_left = 15
corner_radius_top_right = 15
corner_radius_bottom_right = 15
corner_radius_bottom_left = 15
expand_margin_left = 10.0
expand_margin_top = 10.0
expand_margin_right = 10.0
expand_margin_bottom = 10.0

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_oxik7"]
bg_color = Color(1, 1, 1, 1)
corner_radius_top_left = 10
corner_radius_top_right = 10
corner_radius_bottom_right = 10
corner_radius_bottom_left = 10

[sub_resource type="LabelSettings" id="LabelSettings_cvpk3"]
font = ExtResource("18_a3s55")
font_size = 85

[sub_resource type="LabelSettings" id="LabelSettings_d61f6"]
font = ExtResource("18_a3s55")
font_size = 230

[sub_resource type="LabelSettings" id="LabelSettings_opbur"]
font = ExtResource("18_a3s55")
font_size = 85

[sub_resource type="FontVariation" id="FontVariation_fw65x"]
base_font = ExtResource("16_hobtg")

[sub_resource type="LabelSettings" id="LabelSettings_oxik7"]
font = SubResource("FontVariation_fw65x")
font_size = 33

[sub_resource type="LabelSettings" id="LabelSettings_fw65x"]
font = ExtResource("18_a3s55")
font_size = 100

[sub_resource type="FontVariation" id="FontVariation_oxik7"]
base_font = ExtResource("18_a3s55")

[sub_resource type="LabelSettings" id="LabelSettings_h2ex5"]
font = SubResource("FontVariation_oxik7")
font_size = 100

[sub_resource type="FontVariation" id="FontVariation_cvpk3"]
base_font = ExtResource("18_a3s55")

[sub_resource type="LabelSettings" id="LabelSettings_8t331"]
font = SubResource("FontVariation_cvpk3")
font_size = 100

[sub_resource type="ShaderMaterial" id="ShaderMaterial_du4nq"]
shader = ExtResource("2_w5y0b")
shader_parameter/aberration_strength = 3.0
shader_parameter/blur_strength = 2.0
shader_parameter/noise_strength = 0.048
shader_parameter/vignette_strength = 0.78
shader_parameter/scanline_strength = 0.016
shader_parameter/distortion_strength = 0.1
shader_parameter/ghost_strength = 0.12
shader_parameter/flicker_strength = 0.005

[sub_resource type="ShaderMaterial" id="ShaderMaterial_p0vpi"]
shader = ExtResource("3_du4nq")
shader_parameter/wiggle = 0.03
shader_parameter/wiggle_speed = 25.0
shader_parameter/smear = 0.4610000218975
shader_parameter/blur_samples = 15

[node name="Player" type="CharacterBody3D" groups=["player"]]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.625, 0)
collision_layer = 3
collision_mask = 7
script = SubResource("GDScript_sh265")

[node name="intro_dialogue" parent="." instance=ExtResource("21_opbur")]

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
mesh = SubResource("CapsuleMesh_sh265")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("ConvexPolygonShape3D_iyaem")

[node name="PSX_First_Person_Arms" parent="." instance=ExtResource("1_dadds")]
transform = Transform3D(-1.5, 0, -2.2649371e-07, 0, 1.5, 0, 2.2649371e-07, 0, -1.5, 0, -1.6, 0.1)

[node name="Head" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.3, 0)

[node name="Camera3D" type="Camera3D" parent="Head"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.1, -0.2)

[node name="Spotlight" type="Node3D" parent="Head/Camera3D"]

[node name="Flashlight" type="SpotLight3D" parent="Head/Camera3D/Spotlight"]
layers = 3
light_energy = 5.0
light_volumetric_fog_energy = 0.0
spot_range = 35.0
spot_attenuation = 1.15
spot_angle_attenuation = 1.1095695

[node name="Filters" type="CanvasLayer" parent="Head/Camera3D"]

[node name="Interaction_Label" type="Label" parent="Head/Camera3D/Filters"]
anchors_preset = -1
anchor_left = 0.5
anchor_top = 0.817
anchor_right = 0.5
anchor_bottom = 0.817
offset_left = -107.0
offset_top = -15.840088
offset_right = 103.0
offset_bottom = 18.159912
theme_override_font_sizes/font_size = 24
text = "*"
horizontal_alignment = 1
metadata/_edit_use_anchors_ = true

[node name="ObjectInteractor" type="RayCast3D" parent="Head"]
transform = Transform3D(1.5, 0, 0, 0, -6.556708e-08, -1.5, 0, 1.5, -6.556708e-08, 0, -0.099999905, 0)
target_position = Vector3(0, -2.5, 0)
collision_mask = 15
script = ExtResource("4_p0vpi")

[node name="StairsAheadRayCast3D" type="RayCast3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -1.075, -1)
target_position = Vector3(0, -0.55, 0)

[node name="StairsBelowRayCast3D" type="RayCast3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -1.6, 0)

[node name="HeadBob" type="AnimationPlayer" parent="."]
libraries = {
&"": SubResource("AnimationLibrary_wkljg")
}

[node name="Sounds" type="Node3D" parent="."]

[node name="Wood_Step" type="AudioStreamPlayer3D" parent="Sounds"]
stream = ExtResource("6_wkljg")

[node name="Grass_Step" type="AudioStreamPlayer3D" parent="Sounds"]
stream = ExtResource("7_iyaem")

[node name="Outside_BG" type="AudioStreamPlayer3D" parent="Sounds"]
stream = ExtResource("8_iyaem")
autoplay = true
parameters/looping = true

[node name="Stone_Step" type="AudioStreamPlayer3D" parent="Sounds"]
stream = ExtResource("9_ry671")

[node name="Rock_Step" type="AudioStreamPlayer3D" parent="Sounds"]
stream = ExtResource("10_7fxs2")

[node name="Take_Item" type="AudioStreamPlayer3D" parent="Sounds"]
stream = ExtResource("11_xkjxy")

[node name="Use_Item" type="AudioStreamPlayer3D" parent="Sounds"]
stream = ExtResource("12_2k1gg")

[node name="Panting" type="AudioStreamPlayer3D" parent="Sounds"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.9054587, 0)
stream = ExtResource("14_h2ex5")

[node name="Packing" type="AudioStreamPlayer3D" parent="Sounds"]
stream = ExtResource("15_cvpk3")

[node name="FootStepAudio" type="RayCast3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -1.0608809, 0)
visible = false
collision_mask = 2
script = ExtResource("10_4uvqg")

[node name="player_ui" parent="." instance=ExtResource("14_ppdnp")]

[node name="CanvasLayer2" type="CanvasLayer" parent="."]

[node name="TextureProgressBar" type="TextureProgressBar" parent="CanvasLayer2"]
offset_left = 812.0
offset_top = 314.0
offset_right = 1366.0
offset_bottom = 427.0

[node name="SanityBar" type="ProgressBar" parent="CanvasLayer2"]
offset_left = 74.0
offset_top = 55.0
offset_right = 506.0
offset_bottom = 95.0
theme_override_colors/font_color = Color(0, 0, 0, 1)
theme_override_styles/background = SubResource("StyleBoxFlat_ppdnp")
theme_override_styles/fill = SubResource("StyleBoxFlat_7vc3l")
value = 100.0

[node name="SanityBarLabel" type="Label" parent="CanvasLayer2/SanityBar"]
layout_mode = 0
offset_left = 165.0
offset_top = 6.0
offset_right = 265.0
offset_bottom = 34.0
theme_override_colors/font_color = Color(0, 0, 0, 1)
theme_override_font_sizes/font_size = 20
horizontal_alignment = 1
vertical_alignment = 1

[node name="SprintBar" type="ProgressBar" parent="CanvasLayer2"]
offset_left = 76.0
offset_top = 140.0
offset_right = 508.0
offset_bottom = 180.0
theme_override_colors/font_color = Color(0, 0, 0, 1)
theme_override_styles/background = SubResource("StyleBoxFlat_fw65x")
theme_override_styles/fill = SubResource("StyleBoxFlat_oxik7")
value = 100.0

[node name="SprintBarLabel" type="Label" parent="CanvasLayer2/SprintBar"]
layout_mode = 0
offset_left = 165.0
offset_top = 7.0
offset_right = 265.0
offset_bottom = 35.0
theme_override_colors/font_color = Color(0, 0, 0, 1)
theme_override_font_sizes/font_size = 20
horizontal_alignment = 1
vertical_alignment = 1

[node name="FailLabel" type="Label" parent="CanvasLayer2"]
visible = false
offset_right = 1920.0
offset_bottom = 1081.0
text = "\"Ayoko na, gusto ko nang uwuwi...\""
label_settings = SubResource("LabelSettings_cvpk3")
horizontal_alignment = 1
vertical_alignment = 1

[node name="Night_Counter_GamePlay" type="Label" parent="CanvasLayer2"]
visible = false
offset_left = 554.0
offset_top = 423.00003
offset_right = 1447.0
offset_bottom = 664.1845
scale = Vector2(1, 0.8375331)
text = "NIGHT 1"
label_settings = SubResource("LabelSettings_d61f6")
horizontal_alignment = 1

[node name="HauntedLabel" type="Label" parent="CanvasLayer2"]
visible = false
offset_right = 1925.0
offset_bottom = 1110.0
label_settings = SubResource("LabelSettings_opbur")
horizontal_alignment = 1
vertical_alignment = 1

[node name="Timer" type="Timer" parent="."]

[node name="PlayerScreenUI" type="CanvasLayer" parent="."]
script = ExtResource("15_opbur")

[node name="crosshair" type="TextureRect" parent="PlayerScreenUI"]
offset_left = 975.0
offset_top = 531.0
offset_right = 1175.0
offset_bottom = 731.0
scale = Vector2(0.1, 0.1)
texture = ExtResource("15_7vc3l")

[node name="TaskToDoLabel" type="Label" parent="PlayerScreenUI"]
offset_left = 51.0
offset_top = 239.0
offset_right = 606.99994
offset_bottom = 494.5123
scale = Vector2(1, 0.8375331)
text = "

>SAMPLE TASK
>SAMPLE TASK
>SAMPLE TASK"
label_settings = SubResource("LabelSettings_oxik7")

[node name="Night Counter" type="Label" parent="PlayerScreenUI"]
offset_left = 557.0
offset_top = 9.000001
offset_right = 1450.0
offset_bottom = 153.47195
scale = Vector2(1, 0.8375331)
text = "NIGHT "
label_settings = SubResource("LabelSettings_fw65x")
horizontal_alignment = 1

[node name="Panel" type="Panel" parent="PlayerScreenUI"]
offset_left = 1257.0
offset_top = 12.0
offset_right = 1877.0
offset_bottom = 12.0
script = ExtResource("17_sghav")

[node name="TimerLabelHour" type="Label" parent="PlayerScreenUI/Panel"]
layout_mode = 0
offset_left = 299.0
offset_top = 27.0
offset_right = 459.0
offset_bottom = 165.0
theme_override_font_sizes/font_size = 14
text = "12:"
label_settings = SubResource("LabelSettings_h2ex5")

[node name="TimerLabelMinutes" type="Label" parent="PlayerScreenUI/Panel"]
layout_mode = 0
offset_left = 503.0
offset_top = 28.0
offset_right = 610.0
offset_bottom = 128.0
theme_override_font_sizes/font_size = 16
text = "00 "
label_settings = SubResource("LabelSettings_8t331")

[node name="Open eyes" type="TextureRect" parent="PlayerScreenUI"]
modulate = Color(1, 1, 1, 0.64705884)
offset_left = 1748.0
offset_top = 137.0
offset_right = 1857.375
offset_bottom = 240.0
scale = Vector2(0.96, 1)
texture = ExtResource("20_opbur")

[node name="Close eyes" type="TextureRect" parent="PlayerScreenUI"]
modulate = Color(1, 1, 1, 0.5411765)
offset_left = 1751.0
offset_top = 145.0
offset_right = 1851.0
offset_bottom = 254.0
texture = ExtResource("21_fw65x")

[node name="Task" type="Label" parent="PlayerScreenUI"]
offset_left = 51.0
offset_top = 239.0
offset_right = 606.99994
offset_bottom = 494.5123
scale = Vector2(1, 0.8375331)
label_settings = SubResource("LabelSettings_oxik7")

[node name="CanvasLayer" type="CanvasLayer" parent="."]

[node name="BackBufferCopy" type="BackBufferCopy" parent="CanvasLayer"]
copy_mode = 2

[node name="Post_Processing" type="ColorRect" parent="CanvasLayer"]
material = SubResource("ShaderMaterial_du4nq")
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2

[node name="BackBufferCopy_VHS" type="BackBufferCopy" parent="CanvasLayer"]
copy_mode = 2

[node name="VHS" type="ColorRect" parent="CanvasLayer"]
material = SubResource("ShaderMaterial_p0vpi")
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
